class HeartWalletProvider {
  constructor() {
    this.isHeartWallet = true;
    this.isMetaMask = true;
    this.isRabby = false;
    this._selectedAddress = null;
    this._chainId = null;
    this._isConnected = false;
    this._networkVersion = null;
    this._metamask = {
      isUnlocked: () => Promise.resolve(true)
    };
    this._events = {};
    this._nextRequestId = 1;
    this._pendingRequests = /* @__PURE__ */ new Map();
    window.addEventListener("message", (event) => {
      if (event.source !== window) return;
      if (event.data.target !== "heartwallet-inpage") return;
      this._handleResponse(event.data);
    });
  }
  // EIP-1193 standard method
  async request({ method, params = [] }) {
    return new Promise((resolve, reject) => {
      const requestId = this._nextRequestId++;
      this._pendingRequests.set(requestId, { resolve, reject });
      window.postMessage({
        target: "heartwallet-contentscript",
        type: "WALLET_REQUEST",
        requestId,
        method,
        params
      }, window.location.origin);
      setTimeout(() => {
        if (this._pendingRequests.has(requestId)) {
          this._pendingRequests.delete(requestId);
          reject(new Error("Request timeout"));
        }
      }, 6e4);
    });
  }
  // Handle response from content script
  _handleResponse(data) {
    const { requestId, result, error } = data;
    if (!this._pendingRequests.has(requestId)) {
      return;
    }
    const { resolve, reject } = this._pendingRequests.get(requestId);
    this._pendingRequests.delete(requestId);
    if (error) {
      reject(new Error(error.message || error));
    } else {
      if (data.method === "eth_requestAccounts" || data.method === "eth_accounts") {
        if (result && result.length > 0) {
          const newAddress = result[0];
          if (this._selectedAddress !== newAddress) {
            this._selectedAddress = newAddress;
            this._isConnected = true;
            this.emit("accountsChanged", result);
            this.emit("connect", { chainId: this._chainId });
          }
        }
      } else if (data.method === "eth_chainId") {
        if (result && result !== this._chainId) {
          this._chainId = result;
          this._networkVersion = parseInt(result, 16).toString();
          this.emit("chainChanged", result);
        }
      } else if (data.method === "wallet_switchEthereumChain") {
        if (result === null) {
          resolve(result);
          this.request({ method: "eth_chainId" }).catch((err) => {
            console.error("Failed to query chain after switch:", err);
          });
          return;
        }
      }
      resolve(result);
    }
  }
  // Legacy enable method (for older dApps)
  async enable() {
    return this.request({ method: "eth_requestAccounts" });
  }
  // Legacy send method
  async send(methodOrPayload, paramsOrCallback) {
    if (typeof methodOrPayload === "string") {
      return this.request({
        method: methodOrPayload,
        params: paramsOrCallback || []
      });
    }
    if (typeof paramsOrCallback === "function") {
      this.sendAsync(methodOrPayload, paramsOrCallback);
      return;
    }
    return this.request(methodOrPayload);
  }
  // Legacy sendAsync method
  sendAsync(payload, callback) {
    this.request(payload).then((result) => callback(null, {
      id: payload.id,
      jsonrpc: "2.0",
      result
    })).catch((error) => callback(error, null));
  }
  // Event emitter methods
  on(event, callback) {
    if (!this._events[event]) {
      this._events[event] = [];
    }
    this._events[event].push(callback);
  }
  once(event, callback) {
    const wrappedCallback = (...args) => {
      callback(...args);
      this.removeListener(event, wrappedCallback);
    };
    this.on(event, wrappedCallback);
  }
  removeListener(event, callback) {
    if (!this._events[event]) return;
    this._events[event] = this._events[event].filter((cb) => cb !== callback);
  }
  removeAllListeners(event) {
    if (event) {
      delete this._events[event];
    } else {
      this._events = {};
    }
  }
  emit(event, ...args) {
    if (!this._events[event]) return;
    this._events[event].forEach((callback) => {
      try {
        callback(...args);
      } catch (error) {
        console.error("Error in event callback:", error);
      }
    });
  }
  // Connection status
  isConnected() {
    return this._isConnected;
  }
  // Getters for compatibility
  get selectedAddress() {
    return this._selectedAddress;
  }
  get chainId() {
    return this._chainId;
  }
  get networkVersion() {
    return this._networkVersion;
  }
}
if (!window.ethereum) {
  window.ethereum = new HeartWalletProvider();
  window.web3 = {
    currentProvider: window.ethereum
  };
  const announceProvider = () => {
    const info = {
      uuid: "heartwallet-" + Math.random().toString(36).substring(7),
      name: "HeartWallet",
      icon: "data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHZpZXdCb3g9IjAgMCAzMiAzMiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICA8Y2lyY2xlIGN4PSIxNiIgY3k9IjE2IiByPSIxNiIgZmlsbD0iI0UwMDAzNyIvPgogIDxwYXRoIGQ9Ik0xNiA5QzEyLjY4NiA5IDEwIDExLjY4NiAxMCAxNUMxMCAyMC41MjMgMTYgMjYgMTYgMjZDMTYgMjYgMjIgMjAuNTIzIDIyIDE1QzIyIDExLjY4NiAxOS4zMTQgOSAxNiA5WiIgZmlsbD0id2hpdGUiLz4KPC9zdmc+",
      rdns: "com.heartwallet"
    };
    window.dispatchEvent(
      new CustomEvent("eip6963:announceProvider", {
        detail: Object.freeze({ info, provider: window.ethereum })
      })
    );
  };
  announceProvider();
  window.addEventListener("eip6963:requestProvider", (event) => {
    announceProvider();
  });
  window.dispatchEvent(new Event("ethereum#initialized"));
} else {
  console.warn("⚠️ window.ethereum already exists, HeartWallet not injected");
  const announceAlternativeProvider = () => {
    const heartWalletProvider = new HeartWalletProvider();
    const info = {
      uuid: "heartwallet-alt-" + Math.random().toString(36).substring(7),
      name: "HeartWallet",
      icon: "data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHZpZXdCb3g9IjAgMCAzMiAzMiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICA8Y2lyY2xlIGN4PSIxNiIgY3k9IjE2IiByPSIxNiIgZmlsbD0iI0UwMDAzNyIvPgogIDxwYXRoIGQ9Ik0xNiA5QzEyLjY4NiA5IDEwIDExLjY4NiAxMCAxNUMxMCAyMC41MjMgMTYgMjYgMTYgMjZDMTYgMjYgMjIgMjAuNTIzIDIyIDE1QzIyIDExLjY4NiAxOS4zMTQgOSAxNiA5WiIgZmlsbD0id2hpdGUiLz4KPC9zdmc+",
      rdns: "com.heartwallet"
    };
    window.dispatchEvent(
      new CustomEvent("eip6963:announceProvider", {
        detail: Object.freeze({ info, provider: heartWalletProvider })
      })
    );
  };
  announceAlternativeProvider();
  window.addEventListener("eip6963:requestProvider", () => {
    announceAlternativeProvider();
  });
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5wYWdlLmpzIiwic291cmNlcyI6WyIuLi9zcmMvY29udGVudC9pbnBhZ2UtcHJvdmlkZXIuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXHJcbiAqIGNvbnRlbnQvaW5wYWdlLXByb3ZpZGVyLmpzXHJcbiAqXHJcbiAqIEVJUC0xMTkzIGNvbXBhdGlibGUgRXRoZXJldW0gcHJvdmlkZXIgaW5qZWN0ZWQgaW50byB3ZWIgcGFnZXMgYXMgd2luZG93LmV0aGVyZXVtXHJcbiAqL1xyXG5cclxuY2xhc3MgSGVhcnRXYWxsZXRQcm92aWRlciB7XHJcbiAgY29uc3RydWN0b3IoKSB7XHJcbiAgICB0aGlzLmlzSGVhcnRXYWxsZXQgPSB0cnVlO1xyXG4gICAgdGhpcy5pc01ldGFNYXNrID0gdHJ1ZTsgLy8gRm9yIGNvbXBhdGliaWxpdHkgd2l0aCBkQXBwcyB0aGF0IGNoZWNrIGZvciBNZXRhTWFza1xyXG4gICAgdGhpcy5pc1JhYmJ5ID0gZmFsc2U7IC8vIFNldCB0byB0cnVlIGlmIHlvdSB3YW50IHRvIGFwcGVhciBhcyBSYWJieSBpbnN0ZWFkXHJcbiAgICB0aGlzLl9zZWxlY3RlZEFkZHJlc3MgPSBudWxsO1xyXG4gICAgdGhpcy5fY2hhaW5JZCA9IG51bGw7XHJcbiAgICB0aGlzLl9pc0Nvbm5lY3RlZCA9IGZhbHNlO1xyXG4gICAgdGhpcy5fbmV0d29ya1ZlcnNpb24gPSBudWxsO1xyXG5cclxuICAgIC8vIE1ldGFNYXNrLXNwZWNpZmljIHByb3BlcnRpZXMgZm9yIGJldHRlciBjb21wYXRpYmlsaXR5XHJcbiAgICB0aGlzLl9tZXRhbWFzayA9IHtcclxuICAgICAgaXNVbmxvY2tlZDogKCkgPT4gUHJvbWlzZS5yZXNvbHZlKHRydWUpXHJcbiAgICB9O1xyXG5cclxuICAgIC8vIEV2ZW50IGVtaXR0ZXJcclxuICAgIHRoaXMuX2V2ZW50cyA9IHt9O1xyXG4gICAgdGhpcy5fbmV4dFJlcXVlc3RJZCA9IDE7XHJcbiAgICB0aGlzLl9wZW5kaW5nUmVxdWVzdHMgPSBuZXcgTWFwKCk7XHJcblxyXG4gICAgLy8gTGlzdGVuIGZvciByZXNwb25zZXMgZnJvbSBjb250ZW50IHNjcmlwdFxyXG4gICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ21lc3NhZ2UnLCAoZXZlbnQpID0+IHtcclxuICAgICAgaWYgKGV2ZW50LnNvdXJjZSAhPT0gd2luZG93KSByZXR1cm47XHJcbiAgICAgIGlmIChldmVudC5kYXRhLnRhcmdldCAhPT0gJ2hlYXJ0d2FsbGV0LWlucGFnZScpIHJldHVybjtcclxuXHJcbiAgICAgIHRoaXMuX2hhbmRsZVJlc3BvbnNlKGV2ZW50LmRhdGEpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgLy8gUHJvdmlkZXIgaW5pdGlhbGl6ZWRcclxuICB9XHJcblxyXG4gIC8vIEVJUC0xMTkzIHN0YW5kYXJkIG1ldGhvZFxyXG4gIGFzeW5jIHJlcXVlc3QoeyBtZXRob2QsIHBhcmFtcyA9IFtdIH0pIHtcclxuICAgIC8vIFByb3ZpZGVyIHJlcXVlc3RcclxuXHJcbiAgICAvLyBDcmVhdGUgcHJvbWlzZSBmb3IgdGhpcyByZXF1ZXN0XHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xyXG4gICAgICBjb25zdCByZXF1ZXN0SWQgPSB0aGlzLl9uZXh0UmVxdWVzdElkKys7XHJcblxyXG4gICAgICAvLyBTdG9yZSBwcm9taXNlIGNhbGxiYWNrc1xyXG4gICAgICB0aGlzLl9wZW5kaW5nUmVxdWVzdHMuc2V0KHJlcXVlc3RJZCwgeyByZXNvbHZlLCByZWplY3QgfSk7XHJcblxyXG4gICAgICAvLyBTZW5kIG1lc3NhZ2UgdG8gY29udGVudCBzY3JpcHRcclxuICAgICAgLy8gU0VDVVJJVFk6IFVzZSBzcGVjaWZpYyBvcmlnaW4gdG8gcHJldmVudCBtZXNzYWdlIGludGVyY2VwdGlvbiBieSBtYWxpY2lvdXMgc2NyaXB0c1xyXG4gICAgICB3aW5kb3cucG9zdE1lc3NhZ2Uoe1xyXG4gICAgICAgIHRhcmdldDogJ2hlYXJ0d2FsbGV0LWNvbnRlbnRzY3JpcHQnLFxyXG4gICAgICAgIHR5cGU6ICdXQUxMRVRfUkVRVUVTVCcsXHJcbiAgICAgICAgcmVxdWVzdElkLFxyXG4gICAgICAgIG1ldGhvZCxcclxuICAgICAgICBwYXJhbXNcclxuICAgICAgfSwgd2luZG93LmxvY2F0aW9uLm9yaWdpbik7XHJcblxyXG4gICAgICAvLyBUaW1lb3V0IGFmdGVyIDYwIHNlY29uZHNcclxuICAgICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgaWYgKHRoaXMuX3BlbmRpbmdSZXF1ZXN0cy5oYXMocmVxdWVzdElkKSkge1xyXG4gICAgICAgICAgdGhpcy5fcGVuZGluZ1JlcXVlc3RzLmRlbGV0ZShyZXF1ZXN0SWQpO1xyXG4gICAgICAgICAgcmVqZWN0KG5ldyBFcnJvcignUmVxdWVzdCB0aW1lb3V0JykpO1xyXG4gICAgICAgIH1cclxuICAgICAgfSwgNjAwMDApO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvLyBIYW5kbGUgcmVzcG9uc2UgZnJvbSBjb250ZW50IHNjcmlwdFxyXG4gIF9oYW5kbGVSZXNwb25zZShkYXRhKSB7XHJcbiAgICBjb25zdCB7IHJlcXVlc3RJZCwgcmVzdWx0LCBlcnJvciB9ID0gZGF0YTtcclxuXHJcbiAgICBpZiAoIXRoaXMuX3BlbmRpbmdSZXF1ZXN0cy5oYXMocmVxdWVzdElkKSkge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgeyByZXNvbHZlLCByZWplY3QgfSA9IHRoaXMuX3BlbmRpbmdSZXF1ZXN0cy5nZXQocmVxdWVzdElkKTtcclxuICAgIHRoaXMuX3BlbmRpbmdSZXF1ZXN0cy5kZWxldGUocmVxdWVzdElkKTtcclxuXHJcbiAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgcmVqZWN0KG5ldyBFcnJvcihlcnJvci5tZXNzYWdlIHx8IGVycm9yKSk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAvLyBVcGRhdGUgaW50ZXJuYWwgc3RhdGUgYmFzZWQgb24gbWV0aG9kXHJcbiAgICAgIGlmIChkYXRhLm1ldGhvZCA9PT0gJ2V0aF9yZXF1ZXN0QWNjb3VudHMnIHx8IGRhdGEubWV0aG9kID09PSAnZXRoX2FjY291bnRzJykge1xyXG4gICAgICAgIGlmIChyZXN1bHQgJiYgcmVzdWx0Lmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgIGNvbnN0IG5ld0FkZHJlc3MgPSByZXN1bHRbMF07XHJcbiAgICAgICAgICBpZiAodGhpcy5fc2VsZWN0ZWRBZGRyZXNzICE9PSBuZXdBZGRyZXNzKSB7XHJcbiAgICAgICAgICAgIHRoaXMuX3NlbGVjdGVkQWRkcmVzcyA9IG5ld0FkZHJlc3M7XHJcbiAgICAgICAgICAgIHRoaXMuX2lzQ29ubmVjdGVkID0gdHJ1ZTtcclxuICAgICAgICAgICAgdGhpcy5lbWl0KCdhY2NvdW50c0NoYW5nZWQnLCByZXN1bHQpO1xyXG4gICAgICAgICAgICB0aGlzLmVtaXQoJ2Nvbm5lY3QnLCB7IGNoYWluSWQ6IHRoaXMuX2NoYWluSWQgfSk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICB9IGVsc2UgaWYgKGRhdGEubWV0aG9kID09PSAnZXRoX2NoYWluSWQnKSB7XHJcbiAgICAgICAgaWYgKHJlc3VsdCAmJiByZXN1bHQgIT09IHRoaXMuX2NoYWluSWQpIHtcclxuICAgICAgICAgIHRoaXMuX2NoYWluSWQgPSByZXN1bHQ7XHJcbiAgICAgICAgICB0aGlzLl9uZXR3b3JrVmVyc2lvbiA9IHBhcnNlSW50KHJlc3VsdCwgMTYpLnRvU3RyaW5nKCk7XHJcbiAgICAgICAgICB0aGlzLmVtaXQoJ2NoYWluQ2hhbmdlZCcsIHJlc3VsdCk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9IGVsc2UgaWYgKGRhdGEubWV0aG9kID09PSAnd2FsbGV0X3N3aXRjaEV0aGVyZXVtQ2hhaW4nKSB7XHJcbiAgICAgICAgLy8gQWZ0ZXIgc3VjY2Vzc2Z1bCBjaGFpbiBzd2l0Y2gsIHF1ZXJ5IHRoZSBuZXcgY2hhaW4gSURcclxuICAgICAgICAvLyBUaGlzIHdpbGwgdHJpZ2dlciBhbm90aGVyIHJlcXVlc3QgdGhhdCB1cGRhdGVzIF9jaGFpbklkIGFuZCBlbWl0cyBjaGFpbkNoYW5nZWRcclxuICAgICAgICBpZiAocmVzdWx0ID09PSBudWxsKSB7XHJcbiAgICAgICAgICAvLyBSZXNvbHZlIHRoZSBzd2l0Y2ggcmVxdWVzdCBmaXJzdFxyXG4gICAgICAgICAgcmVzb2x2ZShyZXN1bHQpO1xyXG4gICAgICAgICAgLy8gVGhlbiBxdWVyeSB0aGUgbmV3IGNoYWluIHRvIHVwZGF0ZSBzdGF0ZSBhbmQgZW1pdCBldmVudFxyXG4gICAgICAgICAgdGhpcy5yZXF1ZXN0KHsgbWV0aG9kOiAnZXRoX2NoYWluSWQnIH0pLmNhdGNoKGVyciA9PiB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0ZhaWxlZCB0byBxdWVyeSBjaGFpbiBhZnRlciBzd2l0Y2g6JywgZXJyKTtcclxuICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgcmV0dXJuOyAvLyBFYXJseSByZXR1cm4gc2luY2Ugd2UgYWxyZWFkeSByZXNvbHZlZFxyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG5cclxuICAgICAgcmVzb2x2ZShyZXN1bHQpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLy8gTGVnYWN5IGVuYWJsZSBtZXRob2QgKGZvciBvbGRlciBkQXBwcylcclxuICBhc3luYyBlbmFibGUoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5yZXF1ZXN0KHsgbWV0aG9kOiAnZXRoX3JlcXVlc3RBY2NvdW50cycgfSk7XHJcbiAgfVxyXG5cclxuICAvLyBMZWdhY3kgc2VuZCBtZXRob2RcclxuICBhc3luYyBzZW5kKG1ldGhvZE9yUGF5bG9hZCwgcGFyYW1zT3JDYWxsYmFjaykge1xyXG4gICAgaWYgKHR5cGVvZiBtZXRob2RPclBheWxvYWQgPT09ICdzdHJpbmcnKSB7XHJcbiAgICAgIHJldHVybiB0aGlzLnJlcXVlc3Qoe1xyXG4gICAgICAgIG1ldGhvZDogbWV0aG9kT3JQYXlsb2FkLFxyXG4gICAgICAgIHBhcmFtczogcGFyYW1zT3JDYWxsYmFjayB8fCBbXVxyXG4gICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBMZWdhY3kgc2VuZEFzeW5jIGZvcm1hdFxyXG4gICAgaWYgKHR5cGVvZiBwYXJhbXNPckNhbGxiYWNrID09PSAnZnVuY3Rpb24nKSB7XHJcbiAgICAgIHRoaXMuc2VuZEFzeW5jKG1ldGhvZE9yUGF5bG9hZCwgcGFyYW1zT3JDYWxsYmFjayk7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gdGhpcy5yZXF1ZXN0KG1ldGhvZE9yUGF5bG9hZCk7XHJcbiAgfVxyXG5cclxuICAvLyBMZWdhY3kgc2VuZEFzeW5jIG1ldGhvZFxyXG4gIHNlbmRBc3luYyhwYXlsb2FkLCBjYWxsYmFjaykge1xyXG4gICAgdGhpcy5yZXF1ZXN0KHBheWxvYWQpXHJcbiAgICAgIC50aGVuKHJlc3VsdCA9PiBjYWxsYmFjayhudWxsLCB7XHJcbiAgICAgICAgaWQ6IHBheWxvYWQuaWQsXHJcbiAgICAgICAganNvbnJwYzogJzIuMCcsXHJcbiAgICAgICAgcmVzdWx0XHJcbiAgICAgIH0pKVxyXG4gICAgICAuY2F0Y2goZXJyb3IgPT4gY2FsbGJhY2soZXJyb3IsIG51bGwpKTtcclxuICB9XHJcblxyXG4gIC8vIEV2ZW50IGVtaXR0ZXIgbWV0aG9kc1xyXG4gIG9uKGV2ZW50LCBjYWxsYmFjaykge1xyXG4gICAgaWYgKCF0aGlzLl9ldmVudHNbZXZlbnRdKSB7XHJcbiAgICAgIHRoaXMuX2V2ZW50c1tldmVudF0gPSBbXTtcclxuICAgIH1cclxuICAgIHRoaXMuX2V2ZW50c1tldmVudF0ucHVzaChjYWxsYmFjayk7XHJcbiAgfVxyXG5cclxuICBvbmNlKGV2ZW50LCBjYWxsYmFjaykge1xyXG4gICAgY29uc3Qgd3JhcHBlZENhbGxiYWNrID0gKC4uLmFyZ3MpID0+IHtcclxuICAgICAgY2FsbGJhY2soLi4uYXJncyk7XHJcbiAgICAgIHRoaXMucmVtb3ZlTGlzdGVuZXIoZXZlbnQsIHdyYXBwZWRDYWxsYmFjayk7XHJcbiAgICB9O1xyXG4gICAgdGhpcy5vbihldmVudCwgd3JhcHBlZENhbGxiYWNrKTtcclxuICB9XHJcblxyXG4gIHJlbW92ZUxpc3RlbmVyKGV2ZW50LCBjYWxsYmFjaykge1xyXG4gICAgaWYgKCF0aGlzLl9ldmVudHNbZXZlbnRdKSByZXR1cm47XHJcbiAgICB0aGlzLl9ldmVudHNbZXZlbnRdID0gdGhpcy5fZXZlbnRzW2V2ZW50XS5maWx0ZXIoY2IgPT4gY2IgIT09IGNhbGxiYWNrKTtcclxuICB9XHJcblxyXG4gIHJlbW92ZUFsbExpc3RlbmVycyhldmVudCkge1xyXG4gICAgaWYgKGV2ZW50KSB7XHJcbiAgICAgIGRlbGV0ZSB0aGlzLl9ldmVudHNbZXZlbnRdO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGhpcy5fZXZlbnRzID0ge307XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBlbWl0KGV2ZW50LCAuLi5hcmdzKSB7XHJcbiAgICBpZiAoIXRoaXMuX2V2ZW50c1tldmVudF0pIHJldHVybjtcclxuICAgIHRoaXMuX2V2ZW50c1tldmVudF0uZm9yRWFjaChjYWxsYmFjayA9PiB7XHJcbiAgICAgIHRyeSB7XHJcbiAgICAgICAgY2FsbGJhY2soLi4uYXJncyk7XHJcbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgaW4gZXZlbnQgY2FsbGJhY2s6JywgZXJyb3IpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8vIENvbm5lY3Rpb24gc3RhdHVzXHJcbiAgaXNDb25uZWN0ZWQoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5faXNDb25uZWN0ZWQ7XHJcbiAgfVxyXG5cclxuICAvLyBHZXR0ZXJzIGZvciBjb21wYXRpYmlsaXR5XHJcbiAgZ2V0IHNlbGVjdGVkQWRkcmVzcygpIHtcclxuICAgIHJldHVybiB0aGlzLl9zZWxlY3RlZEFkZHJlc3M7XHJcbiAgfVxyXG5cclxuICBnZXQgY2hhaW5JZCgpIHtcclxuICAgIHJldHVybiB0aGlzLl9jaGFpbklkO1xyXG4gIH1cclxuXHJcbiAgZ2V0IG5ldHdvcmtWZXJzaW9uKCkge1xyXG4gICAgcmV0dXJuIHRoaXMuX25ldHdvcmtWZXJzaW9uO1xyXG4gIH1cclxufVxyXG5cclxuLy8gSW5qZWN0IHByb3ZpZGVyIGludG8gd2luZG93XHJcbmlmICghd2luZG93LmV0aGVyZXVtKSB7XHJcbiAgd2luZG93LmV0aGVyZXVtID0gbmV3IEhlYXJ0V2FsbGV0UHJvdmlkZXIoKTtcclxuXHJcbiAgLy8gQWxzbyBzZXQgd2luZG93LndlYjMgZm9yIGxlZ2FjeSBkQXBwc1xyXG4gIHdpbmRvdy53ZWIzID0ge1xyXG4gICAgY3VycmVudFByb3ZpZGVyOiB3aW5kb3cuZXRoZXJldW1cclxuICB9O1xyXG5cclxuICAvLyBFSVAtNjk2MzogQW5ub3VuY2UgcHJvdmlkZXIgZm9yIG1vZGVybiB3YWxsZXQgZGV0ZWN0aW9uIChXZWIzTW9kYWwsIFdhbGxldENvbm5lY3QsIGV0Yy4pXHJcbiAgY29uc3QgYW5ub3VuY2VQcm92aWRlciA9ICgpID0+IHtcclxuICAgIGNvbnN0IGluZm8gPSB7XHJcbiAgICAgIHV1aWQ6ICdoZWFydHdhbGxldC0nICsgTWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc3Vic3RyaW5nKDcpLFxyXG4gICAgICBuYW1lOiAnSGVhcnRXYWxsZXQnLFxyXG4gICAgICBpY29uOiAnZGF0YTppbWFnZS9zdmcreG1sO2Jhc2U2NCxQSE4yWnlCM2FXUjBhRDBpTXpJaUlHaGxhV2RvZEQwaU16SWlJSFpwWlhkQ2IzZzlJakFnTUNBek1pQXpNaUlnWm1sc2JEMGlibTl1WlNJZ2VHMXNibk05SW1oMGRIQTZMeTkzZDNjdWR6TXViM0puTHpJd01EQXZjM1puSWo0S0lDQThZMmx5WTJ4bElHTjRQU0l4TmlJZ1kzazlJakUySWlCeVBTSXhOaUlnWm1sc2JEMGlJMFV3TURBek55SXZQZ29nSUR4d1lYUm9JR1E5SWsweE5pQTVRekV5TGpZNE5pQTVJREV3SURFeExqWTROaUF4TUNBeE5VTXhNQ0F5TUM0MU1qTWdNVFlnTWpZZ01UWWdNalpETVRZZ01qWWdNaklnTWpBdU5USXpJREl5SURFMVF6SXlJREV4TGpZNE5pQXhPUzR6TVRRZ09TQXhOaUE1V2lJZ1ptbHNiRDBpZDJocGRHVWlMejRLUEM5emRtYysnLFxyXG4gICAgICByZG5zOiAnY29tLmhlYXJ0d2FsbGV0J1xyXG4gICAgfTtcclxuXHJcbiAgICB3aW5kb3cuZGlzcGF0Y2hFdmVudChcclxuICAgICAgbmV3IEN1c3RvbUV2ZW50KCdlaXA2OTYzOmFubm91bmNlUHJvdmlkZXInLCB7XHJcbiAgICAgICAgZGV0YWlsOiBPYmplY3QuZnJlZXplKHsgaW5mbywgcHJvdmlkZXI6IHdpbmRvdy5ldGhlcmV1bSB9KVxyXG4gICAgICB9KVxyXG4gICAgKTtcclxuICB9O1xyXG5cclxuICAvLyBBbm5vdW5jZSBpbW1lZGlhdGVseVxyXG4gIGFubm91bmNlUHJvdmlkZXIoKTtcclxuXHJcbiAgLy8gTGlzdGVuIGZvciBkaXNjb3ZlcnkgcmVxdWVzdHMgZnJvbSBkQXBwc1xyXG4gIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdlaXA2OTYzOnJlcXVlc3RQcm92aWRlcicsIChldmVudCkgPT4ge1xyXG4gICAgYW5ub3VuY2VQcm92aWRlcigpO1xyXG4gIH0pO1xyXG5cclxuICAvLyBMZWdhY3kgYW5ub3VuY2VtZW50IGV2ZW50c1xyXG4gIHdpbmRvdy5kaXNwYXRjaEV2ZW50KG5ldyBFdmVudCgnZXRoZXJldW0jaW5pdGlhbGl6ZWQnKSk7XHJcbn0gZWxzZSB7XHJcbiAgY29uc29sZS53YXJuKCfimqDvuI8gd2luZG93LmV0aGVyZXVtIGFscmVhZHkgZXhpc3RzLCBIZWFydFdhbGxldCBub3QgaW5qZWN0ZWQnKTtcclxuXHJcbiAgLy8gRXZlbiBpZiB3aW5kb3cuZXRoZXJldW0gZXhpc3RzLCB0cnkgdG8gYW5ub3VuY2UgdmlhIEVJUC02OTYzIGFzIGFuIGFsdGVybmF0aXZlIHByb3ZpZGVyXHJcbiAgY29uc3QgYW5ub3VuY2VBbHRlcm5hdGl2ZVByb3ZpZGVyID0gKCkgPT4ge1xyXG4gICAgY29uc3QgaGVhcnRXYWxsZXRQcm92aWRlciA9IG5ldyBIZWFydFdhbGxldFByb3ZpZGVyKCk7XHJcbiAgICBjb25zdCBpbmZvID0ge1xyXG4gICAgICB1dWlkOiAnaGVhcnR3YWxsZXQtYWx0LScgKyBNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDM2KS5zdWJzdHJpbmcoNyksXHJcbiAgICAgIG5hbWU6ICdIZWFydFdhbGxldCcsXHJcbiAgICAgIGljb246ICdkYXRhOmltYWdlL3N2Zyt4bWw7YmFzZTY0LFBITjJaeUIzYVdSMGFEMGlNeklpSUdobGFXZG9kRDBpTXpJaUlIWnBaWGRDYjNnOUlqQWdNQ0F6TWlBek1pSWdabWxzYkQwaWJtOXVaU0lnZUcxc2JuTTlJbWgwZEhBNkx5OTNkM2N1ZHpNdWIzSm5Mekl3TURBdmMzWm5JajRLSUNBOFkybHlZMnhsSUdONFBTSXhOaUlnWTNrOUlqRTJJaUJ5UFNJeE5pSWdabWxzYkQwaUkwVXdNREF6TnlJdlBnb2dJRHh3WVhSb0lHUTlJazB4TmlBNVF6RXlMalk0TmlBNUlERXdJREV4TGpZNE5pQXhNQ0F4TlVNeE1DQXlNQzQxTWpNZ01UWWdNallnTVRZZ01qWkRNVFlnTWpZZ01qSWdNakF1TlRJeklESXlJREUxUXpJeUlERXhMalk0TmlBeE9TNHpNVFFnT1NBeE5pQTVXaUlnWm1sc2JEMGlkMmhwZEdVaUx6NEtQQzl6ZG1jKycsXHJcbiAgICAgIHJkbnM6ICdjb20uaGVhcnR3YWxsZXQnXHJcbiAgICB9O1xyXG5cclxuICAgIHdpbmRvdy5kaXNwYXRjaEV2ZW50KFxyXG4gICAgICBuZXcgQ3VzdG9tRXZlbnQoJ2VpcDY5NjM6YW5ub3VuY2VQcm92aWRlcicsIHtcclxuICAgICAgICBkZXRhaWw6IE9iamVjdC5mcmVlemUoeyBpbmZvLCBwcm92aWRlcjogaGVhcnRXYWxsZXRQcm92aWRlciB9KVxyXG4gICAgICB9KVxyXG4gICAgKTtcclxuICB9O1xyXG5cclxuICBhbm5vdW5jZUFsdGVybmF0aXZlUHJvdmlkZXIoKTtcclxuXHJcbiAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ2VpcDY5NjM6cmVxdWVzdFByb3ZpZGVyJywgKCkgPT4ge1xyXG4gICAgYW5ub3VuY2VBbHRlcm5hdGl2ZVByb3ZpZGVyKCk7XHJcbiAgfSk7XHJcbn1cclxuIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQU1BLE1BQU0sb0JBQW9CO0FBQUEsRUFDeEIsY0FBYztBQUNaLFNBQUssZ0JBQWdCO0FBQ3JCLFNBQUssYUFBYTtBQUNsQixTQUFLLFVBQVU7QUFDZixTQUFLLG1CQUFtQjtBQUN4QixTQUFLLFdBQVc7QUFDaEIsU0FBSyxlQUFlO0FBQ3BCLFNBQUssa0JBQWtCO0FBR3ZCLFNBQUssWUFBWTtBQUFBLE1BQ2YsWUFBWSxNQUFNLFFBQVEsUUFBUSxJQUFJO0FBQUEsSUFDNUM7QUFHSSxTQUFLLFVBQVU7QUFDZixTQUFLLGlCQUFpQjtBQUN0QixTQUFLLG1CQUFtQixvQkFBSTtBQUc1QixXQUFPLGlCQUFpQixXQUFXLENBQUMsVUFBVTtBQUM1QyxVQUFJLE1BQU0sV0FBVyxPQUFRO0FBQzdCLFVBQUksTUFBTSxLQUFLLFdBQVcscUJBQXNCO0FBRWhELFdBQUssZ0JBQWdCLE1BQU0sSUFBSTtBQUFBLElBQ2pDLENBQUM7QUFBQSxFQUdIO0FBQUE7QUFBQSxFQUdBLE1BQU0sUUFBUSxFQUFFLFFBQVEsU0FBUyxDQUFBLEVBQUUsR0FBSTtBQUlyQyxXQUFPLElBQUksUUFBUSxDQUFDLFNBQVMsV0FBVztBQUN0QyxZQUFNLFlBQVksS0FBSztBQUd2QixXQUFLLGlCQUFpQixJQUFJLFdBQVcsRUFBRSxTQUFTLE9BQU0sQ0FBRTtBQUl4RCxhQUFPLFlBQVk7QUFBQSxRQUNqQixRQUFRO0FBQUEsUUFDUixNQUFNO0FBQUEsUUFDTjtBQUFBLFFBQ0E7QUFBQSxRQUNBO0FBQUEsTUFDUixHQUFTLE9BQU8sU0FBUyxNQUFNO0FBR3pCLGlCQUFXLE1BQU07QUFDZixZQUFJLEtBQUssaUJBQWlC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
